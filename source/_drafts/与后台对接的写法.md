---
title: 与后台对接的写法.md
tags:
---

## 如何对接

与后台对接有很多方式，例如 ajax，fetch 等，我们可以从中选择一种或多种进行对接。

## 什么是 Ajax

Ajax 是无需刷新页面就能够从服务器取得数据的一种方法，其核心对象是 XMLHttpRequest。

### 原生 Ajax 写法

GET

```js
// 只支持IE7以上版本
var xmlhttp = new XMLHttpRequest();
xmlhttp.open("GET", "serverjson.php?number=3");
xmlhttp.send();
xmlhttp.onreadystatechange = function() {
  if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
    var data = JSON.parse(xmlhttp.responseText);
    if (data.success) {
      // todo
    } else {
      // todo
    }
  }
};
```

POST

```js
var xmlhttp = new XMLHttpRequest();
xmlhttp.open("POST", "serverjson.php");
var data = "name=xiaoming&num=3";
xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
xmlhttp.send(data);
xmlhttp.onreadystatechange = function() {
  if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
    var data = JSON.parse(xmlhttp.responseText);
    if (data.success) {
      // todo
    } else {
      // todo
    }
  }
};
```

### Jquery 的 Ajax 写法

GET

```js
$.ajax({
  type: "GET",
  url: "serverjson.php?number=3",
  dataType: "json",
  success: function(data) {
    if (data.success) {
      // todo
    } else {
      // todo
    }
  },
  error: function(jqXHR) {
    alert("发生错误：" + jqXHR.status);
  }
});
```

POST

```js
$.ajax({
  type: "POST",
  url: "serverjson.php",
  dataType: "json",
  data: {
    name: "xiaoming",
    num: 3
  },
  success: function(data) {
    if (data.success) {
      // todo
    } else {
      // todo
    }
  },
  error: function(jqXHR) {
    alert("发生错误：" + jqXHR.status);
  }
});
```

## 什么是 fetch

它提供了一个获取资源的接口（包括跨域）。

### 基本的写法

GET

```js
fetch("http://example.com/movies.json")
  .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {
    console.log(myJson);
  });
```

POST

```js
var url = "https://example.com/profile";
var data = { username: "example" };

fetch(url, {
  method: "POST", // or 'PUT'
  body: JSON.stringify(data), // data can be `string` or {object}!
  headers: new Headers({
    "Content-Type": "application/json"
  })
})
  .then(res => res.json())
  .catch(error => console.error("Error:", error))
  .then(response => console.log("Success:", response));
```

{% note warning %}
fetch 是**不支持 IE 的**，如果要兼容低版本的浏览器，那么不建议使用 fetch，还有一点需要注意的是 fetch 默认是**禁用发送或者接收 cookies**，因此在网站中如果用到 cookie，那么需要手动允许 cookie
{% endnote %}

## 参考教程
[MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch)