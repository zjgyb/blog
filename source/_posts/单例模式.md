---
title: 单例模式
tags:
  - JavaScript
  - 单例模式
  - 设计模式
  - Vue
copyright: true
date: 2019-05-25 09:40:53
category: JavaScript
keywords:
description: 解释单例模式是什么以及单例模式使用的具体场景
images: /单例模式/js-singletons.png
---


## 解释

### 什么是单例模式？

单例就是保证一个类只有一个实例，实现的方法是判断实例是否存在与否，如果存在直接返回，如果不存在就创建了再返回，这就确保了一个类只有一个实例对象。

### 模块作用

1. 模块间通信
2. 系统中某个类的对象只能存在一个
3. 保护自己的属性和方法

## 简单的单例模式

```js js
let home = {
  style: "Chinese styles",
  door() {
    // ...
  },
  window() {
    //...
  }
};
```

## 以一个弹窗为例

以第一篇参考文章为例，使用 ES6 实现其效果

### 前置代码

html 部分，css 自行补充

```html html
<div class="btn-group">
  <button id="open" class="btn btn-primary">
    打开
  <&#47;button>
  <button id="delete" class="btn btn-default">关闭<&#47;button>
<&#47;div>
```

### 创建主要代码

先创建一个 Modal 类

```js js
class Modal {
  constructor(id, html) {
    this.html = html;
    this.id = id;
    this.open = false;
    this.instance = null;
  }

  create() {
    if (!this.open) {
      const modal = document.createElement("div");
      modal.innerHTML = this.html;
      modal.id = this.id;
      document.body.appendChild(modal);
      setTimeout(() => {
        modal.classList.add("show");
      }, 0);

      this.open = true;
    }
  }

  delete() {
    if (this.open) {
      const modal = $(this.id);
      modal.classList.add("hide");
      setTimeout(() => {
        document.body.removeChild(modal);
      }, 200);
      this.open = false;
    }
  }

  static createIntance(id, html) {
    return this.instance || (this.instance = new Modal(id, html));
  }
}
```

{% note primary %}
使用了惰性单例模式：在需要的时候创建单例，再次调用就使用第一次实例化后的实例对象
{% endnote %}

剩余部分

```js js
// class Modal ...

const $ = id => {
  return typeof id === "string" ? document.getElementById(id) : id;
};

const operate = {
  setModal: null,
  open() {
    this.setModal = Modal.createIntance("modal", "这是一个弹窗");
    this.setModal.create();
  },
  delete() {
    this.setModal && this.setModal.delete();
  }
};

$("open").onclick = () => {
  operate.open();
};

$("delete").onclick = () => {
  operate.delete();
};
```

{% note %}
其实`operate`就是一个普通的单例模式
{% endnote %}

## 在Vue中的使用

### 效果

<img src="/单例模式/show.png" width="100%" alt="单例模式图片" />

点击按钮能够新增条目，点击条目能够删除这一行

### 目录结构

```
|- src
|   |- components
|       |- dialog-container
|           |- dialog-container.vue
|           |- index.js
|   |- App.vue
|   |- main.js
```
### 具体实现

```html vue
<!-- dialog-container.vue -->
<template>
  <div>
    <ul>
      <li v-for="list in lists" :key="list.id" @click="del(list.id)">{{ list.content }}<&#47;li>
    <&#47;ul>
  <&#47;div>
<&#47;template>

<script>
export default {
  methods: {
    del(id) {
      const index = this.lists.findIndex(ele => ele.id === id);
      if (-1 !== index) {
        this.lists.splice(index, 1);
      }
    }
  }
};
<&#47;script>
```

具体单例使用

```js js
import Vue from "vue";

import Container from "./dialog-container.vue";

Container.installSlot = (() => {
  let [component, lists] = [null, null];

  return (id, list) => {
    if (typeof list === "object" && typeof id === "string") {
      if (!component) {
        const container = Vue.extend(Container);
        lists = [list];
        component = new container({
          data() {
            return {
              lists
            };
          }
        });

        document.getElementById(id).appendChild(component.$mount().$el);
      } else {
        lists.push(list);
      }
    }
  };
})();

export default {
  install: Vue => {
    Vue.prototype.$dialog = Container.installSlot;
  }
};
```

配置及使用

```js js
import Dialog from "./components/dialog-container";
Vue.use(Dialog);
```

```html html
<template>
  <div id="app">
    <div id="content">
      <button @click="hi('content')">Hellos<&#47;button>
    <&#47;div>
  <&#47;div>
<&#47;template>
<script>
export default {
  name: "App",
  methods: {
    hi(domId) {
      const id = Math.random()
        .toString()
        .substr(2, 6);

      // 使用
      this.$dialog(domId, {
        id,
        content: `The id is ${id}`
      });
    }
  }
};
<&#47;script>
```

## 总结

单例模式其他具体场景不是很清楚，希望以后能够看到其他用法，对于设计模式我也才刚开始看，继续努力。

## 参考文章

- [http://www.codeceo.com/article/javascript-single-instance.html](http://www.codeceo.com/article/javascript-single-instance.html)
- [Solo Jiang's blog](https://solojiang.github.io/2018/04/30/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%9C%A8Dialog%E7%B1%BB%E7%BB%84%E4%BB%B6%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8/)
- [知乎-从 ES6 重新认识 JavaScript 设计模式(一): 单例模式](https://zhuanlan.zhihu.com/p/34754447)
- [YouTube](https://www.youtube.com/watch?v=X7GJ485r20A&list=PL9nxfq1tlKKnsi68A6Gbsv-ip8kRNFK7-&index=2)
