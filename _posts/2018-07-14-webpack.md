---
layout: post
title:  webpack
data: 2018-07-14 21:43:00 +800
categories: front-end js
tags: webpack
excerpt: webpack将多种文件转换成一个静态文件，正好有空学习一下
img: /photoes/webpack.png
---

#### 安装
安装的话这里不再单独介绍，网上有很多关于安装webpack
#### webpack基本命令
* `webpack` 打包成开发环境 
* `webpack -p` 打包成生产环境（压缩代码）

#### package.json
+ Note: scripts指定了运行脚本命令的npm命令行缩写，比如start指定了运行npm run start时，所要执行的命令。<br>
执行时只需命令`npm run dev`
``` js
{
    "script": {
        "dev": "webpack-dev-server --devtool eval --progress --colors",
        "deploy": "NODE_ENV=production webpack -p"
    }
}
```

#### webpack.config.js主要语法介绍
+ 单个文件
``` js
module.exports = {
    entry: './main.js', // 入口文件
    output: {
        filename: 'bundle' // 输出文件
    }
}
```
+ 多个文件
``` js
module.exports = {
    entry: {
        bundle1: './main1.js',
        bundle2: './main2.js'
    },
    output: {
        filename: '[name].js'
    }
}
```
* babel-loader转化es6和jsx(新增部分)
``` js
module.exports = {
    module: {
        rules: [
            {
                test: /\.jsx?$/,
                exclude: /node_modules/,
                use: {
                    loader: 'babel-loader',
                    options: {
                        presets: ['es2015', 'react']
                    }
                }
            }
        ]
    }
}
```
+ css-loader 在js中能引用css
``` js
// main.js
require('./filename.css');
```
webpack.config.js
``` js
// css-loader代表读取css文件, style-loader代表在html嵌入<style>标签
module.exports = {
    module: {
        rules: [
            {
                test: /\.css$/,
                use: ['style-loader', 'css-loader']
            },
        ]
    }
};
```
图片的引用及设置
``` js
// main.js
var img1 = document.createElement('img');
img1.src = require('location/filename.css');
document.body.appendChild('img1');
```
webpack.config.js
``` js
// 小于8192字节的url转化成data类型url，大于的就还是正常的url
module.exports = {
    module: {
        rules: [
            {
                test: /\.(png|jpg)$/,
                options: {
                    limit: 8192
                }
            }
        ]
    }
}
```
css module
``` css
/* app.css */
/* 会转化成hash */
.h1 {
    color: red;
}
/* 全局属性 */
:global(.h2) {
    color: blue
}
```
webpack.config.js(新增部分)
``` js
module.exports = {
    module: {
        rules: [
            {
                test: /\.js[x]?$/,
                exclude: /node_modules/,
                use: {
                    loader: 'bable-loader',
                    options: {
                        presets: ['es2015', 'react']
                    }
                }
            },
            {
                test: /\.css$/,
                use: [
                    {
                        loader: 'style-loader'
                    },
                    {
                        loader: 'css-loader',
                        options: {
                            modules: true
                        }
                    }
                ]
            }
        ]
    }
}
```
插件UglifyJs,压缩代码
``` js
const webpack = require('webpack');
const UglifyJsPlugin = require('uglifyjs-webpack-plugin');
module.exports = {
    plugins: [
        new UglifyJsPlugin()
    ]
}
```
html-webpack-plugin和open-browser-webpack-plugin
``` js
const HtmlwebpackPlugin = require('html-webpack-plugin');
const OpenBrowserPlugin = require('open-browser-webpack-plugin');
module.exports = {
    plugins: [
        new HtmlwebpackPlugin({
            title: 'webpack-demos',
            filename: 'index.html'
        }),
        new OpenBrowserPlugin({
            url: 'http://localhost:8080'
        })
    ]
}
```
{:note: .custom-block.warning}
+ html-webpack-plugin代表生成index.html文件
+ open-browser-webpack-plugin代表自动打开浏览器
{: note}
代码分隔
+ main.js
```js
require.ensure(['./a'], function(require) {
    const content = require('./a');
    document.open();
    // some code for example
    document.write('<h1>' + content + '</h1>');
    doucument.close();
});
```
a.js
```js
module.exports = 'hello world';
```
+ 另一种实现方式(main.js)
```js
var load = require('bundle-loader!./a.js');
load(function(file) {
    document.open();
    document.write('<h1>' + file + '</h1>');
})
```

常见的块，例如
```js
// main1.jsx
const React = require('react');
const ReactDOM = require('react-dom');
// main2.jsx
const React = require('react');
const ReactDOM = require('react-dom');
```
{:note: .custom-block.warning}
两个都有相同的部分我们可以用同一个js来一起引用它
{: note}
+ webpack.config.js配置
```js
const webpack = require('webpack');
module.exports = {
    plugins: [
        new webpack.optimize.CommonsChunkPlugin({
            name: 'commons',
            filename: 'common.js'
        })
    ]
}
```